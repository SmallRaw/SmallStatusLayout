apply plugin: 'maven-publish'

ext {
    GitHubPackageUrl = "https://maven.pkg.github.com/smallraw/SmallStatusLayout"
}

String localProperty(propertyName) {
    Properties properties = new Properties()
    File file = project.rootProject.file('local.properties')
    if (file.exists()) {
        properties.load(file.newDataInputStream())
        return properties.getProperty(propertyName)
    }
    return ""
}

// 上传到 GitHub package 的名字是项目名字。如本项目的 smallstatus-layout.
// 不能大写，大写无法上传
afterEvaluate {
    publishing {
        repositories {
            maven {
                name = "GithubPackages"
                url = uri(GitHubPackageUrl)
                credentials {
                    username = System.getenv('GITHUB_USER') ?: localProperty('GITHUB_USER')
                    password = System.getenv('GITHUB_TOKEN') ?: localProperty('GITHUB_TOKEN')
                }
            }
        }
    }
}